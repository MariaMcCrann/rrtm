<!DOCTYPE html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>RRTM</title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

    <!-- Google Web Fonts: http://www.google.com/webfonts/v2#AboutPlace:about-->
    <link href='http://fonts.googleapis.com/css?family=Kameron|Lora|Quattrocento&v2' rel='stylesheet' type='text/css'>

	<style type="text/css" media="screen">
		body {
		   font-family: 'Quattrocento', Georgia, "Times New Roman", Times, serif;
		   margin-left: 10%;
		   margin-right: 10%;
		   min-width: 1100px;
		}
		svg {
	      shape-rendering: crispEdges;
	    }
	    .rule line {
	      stroke: #eee;
	    }
	</style>
</head>
<body>
	<p>
		<select name='atmosphere' onchange='updatechart();'>
			<option value='midlatitude_summer' selected='selected'>mid-latitude summer</option>
			<option value='midlatitude_winter'>mid-latitude winter</option>
			<option value='tropic'>tropics</option>
		</select>
	<center>
	<div id="paired-line-chart">

	</div>
	</center>
</body>
    
<script type="text/javascript"> 
    updatechart = function() {
	    var atmosphere = d3.select('select')[0][0].options[d3.select('select')[0][0].selectedIndex].value;
        d3.json('../cgi-bin/rrtm.py?atmosphere=' + atmosphere, function(error, json) {
		    if (error) return console.warn(error);

            var lwDownLayer = json.longwave.downward.map(function(d, i) {return {x: i, y: d}});
            var lwUpLayer = json.longwave.upward.map(function(d, i) {return {x: i, y: d}});
            
            offset = function(data) {
                var j = -1,
                m = data[0].length,
                ymax = d3.max(data[0], function(d) { return d[1]}),
                y0 = [];
                return data[0].map(function(d,i) { return ymax - d[1] });
            }
            
            layers = d3.layout.stack().offset(offset)([lwDownLayer, lwUpLayer]);
            
            var xmax = d3.max(layers, function(layer) {return d3.max(layer, function(d) { return d.y0 + d.y; }); });
            
            var  width = 200,
                 height = 500;
            
            var x = d3.scale.linear()
                .domain([0, xmax]).range([0, width]);
            
            var y = d3.scale.linear()
                .domain([0, lwDownLayer.length - 1])
                .range([height, 0]);
            
            var color = d3.scale.linear()
                .range(["#aad", "#556"]);

			 d3.select('svg').remove()

             var area = d3.svg.area()
                 .x0(function(d) { return x(d.y0); })
                 .x1(function(d) { return x(d.y0 + d.y); })
                 .y(function(d) { return y(d.x); });

             var svg = d3.select("#paired-line-chart").append("svg")
                 .attr("width", width)
                 .attr("height", height);

             svg.selectAll("path")
                 .data(layers)
               .enter().append("path")
                 .attr("d", area)
                 .style("fill", function(d, i) { return ['rgb(249,152,0)', 'rgb(228,105,0)'][i]; });



	});
	//.header("Content-Type","application/x-www-form-urlencoded")
 	// .send("POST","a=b");
};
</script>